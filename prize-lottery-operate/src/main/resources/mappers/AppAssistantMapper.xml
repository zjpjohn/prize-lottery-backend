<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prize.lottery.infrast.persist.mapper.AppAssistantMapper">

    <resultMap id="AppAssistantMap" type="com.prize.lottery.infrast.persist.po.AppAssistantPo">
        <id column="id" property="id"/>
        <result column="app_no" property="appNo"/>
        <result column="suit_ver" property="suitVer"/>
        <result column="type" property="type"/>
        <result column="title" property="title"/>
        <result column="content" property="content"/>
        <result column="sort" property="sort"/>
        <result column="state" property="state"/>
        <result column="remark" property="remark"/>
        <result column="gmt_create" property="gmtCreate"/>
        <result column="gmt_modify" property="gmtModify"/>
    </resultMap>

    <insert id="addAppAssistant" parameterType="com.prize.lottery.infrast.persist.po.AppAssistantPo"
            useGeneratedKeys="true" keyProperty="id">
        insert into
        app_assistant(
        app_no,
        suit_ver,
        type,
        title,
        content,
        state,
        sort,
        <if test="remark!=null">
            remark,
        </if>
        gmt_create,
        gmt_modify)
        values
        (#{appNo},
        <choose>
            <when test="suitVer!=null">
                #{suitVer},
            </when>
            <otherwise>
                ''
            </otherwise>
        </choose>
        #{type},
        #{title},
        #{content},
        #{state},
        #{sort},
        <if test="remark!=null">
            #{remark},
        </if>
        current_time,
        current_time)
    </insert>

    <update id="editAppAssistant" parameterType="com.prize.lottery.infrast.persist.po.AppAssistantPo">
        update app_assistant
        set
        <if test="suitVer!=null">
            suit_ver=#{suitVer},
        </if>
        <if test="title!=null">
            title=#{title},
        </if>
        <if test="content!=null">
            content=#{content},
        </if>
        <if test="sort!=null">
            sort=#{sort},
        </if>
        <if test="state!=null">
            state=#{state},
        </if>
        <if test="remark!=null">
            remark=#{remark},
        </if>
        gmt_modify=current_time
        where
        id=#{id}
    </update>

    <update id="sortAppAssistant">
        <if test="position &gt; sort">
            update app_assistant
            set
            sort=sort-1,
            gmt_modify=current_time
            where
            sort &gt;#{sort}
            and sort &lt;=#{position};
        </if>
        <if test="position &lt; sort">
            update app_assistant
            set
            sort=sort+1,
            gmt_modify=current_time
            where
            sort &gt;=#{position}
            and sort &lt;#{sort};
        </if>
        update app_assistant
        set
        sort=#{position},
        gmt_modify=current_time
        where
        id=#{id};
    </update>

    <select id="getAssistantMaxSort" parameterType="java.lang.String" resultType="java.lang.Integer">
        select
            max(sort)
        from
            app_assistant
        where
            app_no = #{appNo}
    </select>

    <select id="getAppAssistant" parameterType="java.lang.Long" resultMap="AppAssistantMap">
        select
            id,
            app_no,
            suit_ver,
            type,
            title,
            content,
            state,
            sort,
            remark,
            gmt_create,
            gmt_modify
        from
            app_assistant
        where
            id = #{id}
    </select>

    <select id="getUsingAppAssistants" resultMap="AppAssistantMap">
        select
        id,
        app_no,
        suit_ver,
        type,
        title,
        content,
        state,
        sort
        from
        app_assistant
        where
        app_no=#{appNo}
        and suit_ver &lt;=#{version}
        and state=2
        <if test="type!=null and type!=''">
            and type=#{type}
        </if>
        order by
        sort
    </select>

    <select id="getAppAssistants" parameterType="com.cloud.arch.page.PageCondition"
            resultMap="AppAssistantMap">
        select
        id, app_no, suit_ver, type, title, state, sort, remark, gmt_create, gmt_modify
        from
        app_assistant
        where
        app_no=#{condition.appNo}
        <if test="condition.type!=null">
            and type=#{condition.type}
        </if>
        <if test="condition.state!=null">
            and state=#{condition.state}
        </if>
        order by sort desc
        limit #{offset},#{limit}
    </select>

    <select id="countAppAssistants" parameterType="com.cloud.arch.page.PageCondition"
            resultType="java.lang.Integer">
        select
        count(1)
        from
        app_assistant
        where
        app_no=#{condition.appNo}
        <if test="condition.type!=null">
            and type=#{condition.type}
        </if>
        <if test="condition.state!=null">
            and state=#{condition.state}
        </if>
    </select>

</mapper>
