<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prize.lottery.mapper.SsqRecommendMapper">

    <resultMap id="SsqRecommendMap" type="com.prize.lottery.po.ssq.SsqRecommendPo">
        <id column="id" property="id"/>
        <result column="period" property="period"/>
        <result column="calc_time" property="calcTime"/>
        <result column="gmt_create" property="gmtCreate"/>
        <association property="red1" javaType="com.prize.lottery.value.ForecastValue">
            <result column="r1" property="data"/>
            <result column="hit_r1" property="hitData"/>
            <result column="r1_hit" property="dataHit"/>
        </association>
        <association property="red2" javaType="com.prize.lottery.value.ForecastValue">
            <result column="r2" property="data"/>
            <result column="hit_r2" property="hitData"/>
            <result column="r2_hit" property="dataHit"/>
        </association>
        <association property="red3" javaType="com.prize.lottery.value.ForecastValue">
            <result column="r3" property="data"/>
            <result column="hit_r3" property="hitData"/>
            <result column="r3_hit" property="dataHit"/>
        </association>
        <association property="red12" javaType="com.prize.lottery.value.ForecastValue">
            <result column="r12" property="data"/>
            <result column="hit_r12" property="hitData"/>
            <result column="r12_hit" property="dataHit"/>
        </association>
        <association property="red20" javaType="com.prize.lottery.value.ForecastValue">
            <result column="r20" property="data"/>
            <result column="hit_r20" property="hitData"/>
            <result column="r20_hit" property="dataHit"/>
        </association>
        <association property="red25" javaType="com.prize.lottery.value.ForecastValue">
            <result column="r25" property="data"/>
            <result column="hit_r25" property="hitData"/>
            <result column="r25_hit" property="dataHit"/>
        </association>
        <association property="redKill3" javaType="com.prize.lottery.value.ForecastValue">
            <result column="rk3" property="data"/>
            <result column="hit_rk3" property="hitData"/>
            <result column="rk3_hit" property="dataHit"/>
        </association>
        <association property="redKill6" javaType="com.prize.lottery.value.ForecastValue">
            <result column="rk3" property="data"/>
            <result column="hit_rk3" property="hitData"/>
            <result column="rk3_hit" property="dataHit"/>
        </association>
        <association property="blue3" javaType="com.prize.lottery.value.ForecastValue">
            <result column="b3" property="data"/>
            <result column="hit_b3" property="hitData"/>
            <result column="b3_hit" property="dataHit"/>
        </association>
        <association property="blue5" javaType="com.prize.lottery.value.ForecastValue">
            <result column="b5" property="data"/>
            <result column="hit_b5" property="hitData"/>
            <result column="b5_hit" property="dataHit"/>
        </association>
        <association property="blueKill" javaType="com.prize.lottery.value.ForecastValue">
            <result column="bk" property="data"/>
            <result column="hit_bk" property="hitData"/>
            <result column="bk_hit" property="dataHit"/>
        </association>
    </resultMap>

    <insert id="addSsqRecommend" parameterType="com.prize.lottery.po.ssq.SsqRecommendPo" useGeneratedKeys="true"
            keyProperty="id">
        insert into ssq_recommend(period,
                                  r1,
                                  r2,
                                  r3,
                                  r12,
                                  r20,
                                  r25,
                                  rk3,
                                  rk6,
                                  b3,
                                  b5,
                                  bk,
                                  gmt_create
                                 )
        values (#{period},
                #{red1.data},
                #{red2.data},
                #{red3.data},
                #{red12.data},
                #{red20.data},
                #{red25.data},
                #{redKill3.data},
                #{redKill6.data},
                #{blue3.data},
                #{blue5.data},
                #{blueKill.data},
                current_time
               ) on duplicate key
        update
            r1=
        values (r1), r2=
        values (r2), r3=
        values (r3), r12=
        values (r12), r20=
        values (r20), r25=
        values (r25), rk3=
        values (rk3), rk6=
        values (rk6), b3=
        values (b3), b5=
        values (b5), bk=
        values (bk)
    </insert>

    <update id="editSsqRecommend" parameterType="com.prize.lottery.po.ssq.SsqRecommendPo">
        update ssq_recommend
        set
            hit_r1=#{red1.hitData},
            r1_hit=#{red1.dataHit},
            hit_r2=#{red2.hitData},
            r2_hit=#{red2.dataHit},
            hit_r3=#{red3.hitData},
            r3_hit=#{red3.dataHit},
            hit_r12=#{red12.hitData},
            r12_hit=#{red12.dataHit},
            hit_r20=#{red20.hitData},
            r20_hit=#{red20.dataHit},
            hit_r25=#{red25.hitData},
            r25_hit=#{red25.dataHit},
            hit_rk3=#{redKill3.hitData},
            rk3_hit=#{redKill3.dataHit},
            hit_rk6=#{redKill6.hitData},
            rk6_hit=#{redKill6.dataHit},
            hit_b3=#{blue3.hitData},
            b3_hit=#{blue3.dataHit},
            hit_b5=#{blue5.hitData},
            b5_hit=#{blue5.dataHit},
            hit_bk=#{blueKill.hitData},
            bk_hit=#{blueKill.dataHit},
            calc_time=current_time
        where
            id = #{id}
    </update>

    <sql id="recommendSql">
        id
        ,period,r1,r2,r3,r12,r20,r25,rk3,rk6,b3,b5,bk,gmt_create
    </sql>

    <sql id="recommendHitSql">
        id
        ,period,
        hit_r1,r1_hit,
        hit_r2,r2_hit,
        hit_r3,r3_hit,
        hit_r20,r20_hit,
        hit_r25,r25_hit,
        hit_rk3,rk3_hit,
        hit_rk6,rk6_hit,
        hit_b3,b3_hit,
        hit_b5,b5_hit,
        hit_bk,bk_hit,
        calc_time
    </sql>

    <select id="getSsqRecommendByPeriod" parameterType="java.lang.String" resultMap="SsqRecommendMap">
        select
        <include refid="recommendSql"/>
        from ssq_recommend
        where period=#{period}
    </select>

    <select id="getSsqRecommendHitByPeriod" parameterType="java.lang.String" resultMap="SsqRecommendMap">
        select
        <include refid="recommendHitSql"/>
        from ssq_recommend
        where period=#{period}
    </select>

    <select id="getSsqRecommendList" parameterType="com.cloud.arch.page.PageCondition"
            resultMap="SsqRecommendMap">
        select
        <include refid="recommendHitSql"/>,
        IF(calc_time is null,r1,'') as r1,
        IF(calc_time is null,r2,'') as r2,
        IF(calc_time is null,r3,'') as r3,
        IF(calc_time is null,r12,'') as r12,
        IF(calc_time is null,r20,'') as r20,
        IF(calc_time is null,r25,'') as r25,
        IF(calc_time is null,rk3,'') as rk3,
        IF(calc_time is null,rk6,'') as rk6,
        IF(calc_time is null,b3,'') as b3,
        IF(calc_time is null,b5,'') as b5,
        IF(calc_time is null,bk,'') as bk
        from ssq_recommend
        <where>
            <if test="condition.period!=null">
                period=#{condition.period}
            </if>
            <if test="condition.opened!=null">
                calc_time is not null
            </if>
        </where>
        order by period desc
        limit #{offset},#{limit}
    </select>

    <select id="countSsqRecommendList" parameterType="com.cloud.arch.page.PageCondition"
            resultType="java.lang.Integer">
        select count(1)
        from ssq_recommend
        <where>
            <if test="condition.period!=null">
                period=#{condition.period}
            </if>
            <if test="condition.opened!=null">
                calc_time is not null
            </if>
        </where>
    </select>

    <select id="latestSsqRecommendPeriod" resultType="com.prize.lottery.value.Period">
        select
            period,
            if(calc_time is null, 0, 1) calculated
        from
            ssq_recommend
        order by
            period desc limit 1
    </select>

</mapper>
